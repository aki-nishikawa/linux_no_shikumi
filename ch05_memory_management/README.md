# memory management

## 仮想記憶
### ナイーブなメモリ確保の問題点
C言語では malloc などでメモリを触ることができると言われているが，
実は， Linux 上で動いているプロセスが物理メモリを直接触ることはできない．
事実， segv を実行すると Segmentation Fault になり，プログラムが終了する．

もしもプロセスが物理メモリを直接操作することができる場合，
以下のような問題点が発生する．

* メモリの断片化，フラグメンテーション  
    メモリの獲得，解放を繰り返すことによって空いてるメモリ領域が散り散りになってしまうこと．
* 別プロセスのメモリ領域にアクセスできること  
    メモリの番地を直接指定するだけで任意のメモリ領域にアクセスできる場合，
    カーネルや他のプロセスが使用している領域に簡単にアクセスできてしまう．
    これにより，別プロセスのメモリを書き換えてプロセスを壊したり，
    カーネルの重要な領域を書き換えることができてしまう．
* マルチプロセスの扱いが大変

これらの問題を解決する仕組みが仮想記憶（仮想メモリ）である．


### 仮想記憶
それぞれのプロセスに仮想的なメモリを割り当て，
各プロセスが自身の仮想メモリを占有しているかのように使用する仕組み．
物理メモリと仮想メモリをそれぞれページごとに分割し，
互いの対応関係をページテーブルに記録することで仮想記憶は実現される．
mmap を実行することでメモリマップの新規割り当てを確認することができる．

上述の問題点は以下のように解決される．
* メモリの断片化，フラグメンテーション  
    断片化した物理メモリをひとまとめにして仮想メモリを作成すると，プロセスからはひとまとまりのメモリ領域として認識される．
* 別プロセスのメモリ領域にアクセスできること  
    プロセスは自身に割り当てられた仮想メモリのアドレス以外にアクセスすることができなくなる．
* マルチプロセスの扱いが大変
    プロセスごとに仮想メモリが割り当てられるのでプロセスは自身の仮想メモリを自由に扱うことが可能となる．


## 仮想記憶の応用例
### ファイルマップ
### デマンドページング
### コピーオンライト
### スワップ
### 階層型ページテーブル
### ヒュージページ