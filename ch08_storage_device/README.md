# storage device

## HDD
HDD はデータを磁気ディスクに保存するストレージデバイスである．
ディスクは半径方向，円周方向にセクタと呼ばれる単位で分割されており，
セクタ単位で読み書きされる．
セクタへのアクセスはスイングアームの先に取り付けられた磁気ヘッドで行われる．
磁気ディスクの回転とスイングアームの移動でセクタ上に磁気ヘッドを合わせる．

HDD への読み書きのレイテンシのうち，ほとんどが機械的処理にかかる時間である．
機械的処理の中でも磁気ディスクの回転よりスイングアームの移動のほうが時間がかかるため，
磁気ヘッドを一度合わせてしまえば連続するセクタの内容を一気に読みだすことができる．
そのため，ファイルシステムは HDD 上に配置するファイルデータをなるべく近くに配置する．

## SSD
SSD は読み書きに機械的な処理がないため，多くの場合で HDD よりも高速にアクセスすることができる．
しかし，場合によっては I/O スケジューラの処理のオーバーヘッドが無視できなくなってしまう．

## ブロックデバイス層
ブロックデバイスには様々なものが存在するが，ブロックデバイスに対する処理は共通したものが多いため，
それらの処理はデバイスドライバに実装するのではなく，カーネルのブロックデバイス層が担当する．
ブロックデバイス層には様々な機能が存在する．

### I/O スケジューラ
I/O スケジューラはブロックデバイスへのアクセスをある程度溜め込み，最適化してから，
デバイスドライバに I/O を要求することで I/O 性能の向上を目指す．
処理内容には以下のようなものがある．

- マージ:   連続するセクタへのアクセスを１つにまとめる．
- ソート:   不連続なセクタへのアクセスをセクタ番号順に並べる．

### 先読み
プログラムからデータへのアクセスには空間的局所性がある．
これを利用してアクセス時間の短縮を目指す仕組みが先読みである．
ストレージにアクセスする際にそれに続くセクタを同時に読み込んでおくことで，
空間的局所性どおりに該当データにアクセスされた際，すぐにデータを返すことができる．
アクセスがなかった場合は該当データを破棄する．